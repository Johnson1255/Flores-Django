{% extends "floresvalentin_app/base.html" %}
{% load static %}
{% load i18n %} {# Load i18n tags #}

{% block title %}{% trans "Administración de Productos" %}{% endblock %}

{% block extra_head %}
<style>
    /* Basic styling - can be moved to a CSS file */
    .tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #ccc; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid transparent; border-bottom: 0; margin-bottom: -1px; }
    .tab.active { border-color: #ccc; border-bottom-color: white; background-color: white; font-weight: bold; }
    .tab-content { display: none; padding-top: 20px; }
    .tab-content.active { display: block; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    .form-group textarea { min-height: 80px; }
    .form-group input[type="checkbox"] { width: auto; margin-right: 5px; }
    .btn { padding: 10px 15px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 4px; text-decoration: none; display: inline-block; }
    .btn-danger { background-color: #dc3545; }
    .btn:disabled { background-color: #6c757d; cursor: not-allowed; }
    #productList { width: 100%; border-collapse: collapse; margin-top: 20px; }
    #productList th, #productList td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: top; }
    #productList th { background-color: #f2f2f2; }
    #productList tr:nth-child(even) { background-color: #f9f9f9; }
    .status-indicator { margin-top: 10px; padding: 8px; border-radius: 4px; border: 1px solid; }
    .admin-status { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
    .no-admin-status { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
    .error-message { color: #dc3545; font-size: 0.9em; margin-top: 5px; }
    #result, #manageResult { margin-top: 20px; padding: 10px; border: 1px solid #ccc; min-height: 50px; background-color: #f8f9fa; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4"> {# Use Bootstrap container if available in base.html #}
    <h1>{% trans "Administración de Productos" %}</h1>

    <div id="adminStatus">
        {# Status will be loaded by JavaScript #}
        <p>{% trans "Verificando permisos..." %}</p>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="manage">{% trans "Gestionar Productos" %}</div>
        <div class="tab" data-tab="insert">{% trans "Insertar Producto" %}</div>
    </div>

    {# Tab Content: Manage Products #}
    <div id="manageTab" class="tab-content active">
        <h2>{% trans "Gestionar Productos Existentes" %}</h2>
        <div id="manageResult"><p>{% trans "Cargando productos..." %}</p></div>
        <table id="productList">
            <thead>
                <tr>
                    <th>{% trans "ID" %}</th>
                    <th>{% trans "Nombre" %}</th>
                    <th>{% trans "Categoría" %}</th>
                    <th>{% trans "Precio" %}</th>
                    <th>{% trans "Stock" %}</th>
                    <th>{% trans "Disponible" %}</th>
                    <th>{% trans "Acciones" %}</th>
                </tr>
            </thead>
            <tbody>
                {# Product rows will be loaded by JavaScript #}
                <tr><td colspan="7">{% trans "Cargando..." %}</td></tr>
            </tbody>
        </table>
    </div>

    {# Tab Content: Insert Product #}
    <div id="insertTab" class="tab-content">
        <h2>{% trans "Insertar Nuevo Producto" %}</h2>
        <form id="insertProductForm">
            {% csrf_token %} {# Important for Django POST requests #}
            <div class="form-group">
                <label for="productName">{% trans "Nombre" %}:</label>
                <input type="text" id="productName" name="name" required>
                <div id="error-name" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="productCategory">{% trans "Categoría" %}:</label>
                <select id="productCategory" name="category" required>
                    <option value="">{% trans "Seleccione una categoría" %}...</option>
                    {# Categories will be loaded by JavaScript or passed from view #}
                    {% for category in categories %} {# Assuming categories are passed in context #}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
                 <div id="error-category" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="productDescription">{% trans "Descripción" %}:</label>
                <textarea id="productDescription" name="description"></textarea>
                 <div id="error-description" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="productPrice">{% trans "Precio" %} (COP):</label>
                <input type="number" id="productPrice" name="price" step="0.01" required min="0">
                 <div id="error-price" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="productStock">{% trans "Stock" %}:</label>
                <input type="number" id="productStock" name="stock" required min="0" value="0">
                 <div id="error-stock" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="productAvailable">
                    <input type="checkbox" id="productAvailable" name="available" checked>
                    {% trans "Disponible para la venta" %}
                </label>
                 <div id="error-available" class="error-message"></div>
            </div>
            {# Add Image field if needed - requires different handling (FormData) #}
            {# <div class="form-group">
                <label for="productImage">Imagen:</label>
                <input type="file" id="productImage" name="image" accept="image/*">
            </div> #}

            <button type="submit" id="insertBtn" class="btn" disabled>{% trans "Insertar Producto" %}</button>
        </form>
        <div id="result"><p>{% trans "Complete el formulario para agregar un producto." %}</p></div>
    </div>

</div> {# End container #}
{% endblock %}

{% block extra_js %}
{# Link to the new JavaScript file we will create #}
<script src="{% static 'js/manage_products.js' %}"></script>
{% endblock %}
